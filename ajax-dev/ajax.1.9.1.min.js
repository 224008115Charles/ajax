(function(f){var g={url:"",type:"post",baseURL:"",data:{},async:true,requestHeader:{},publicData:{},timeout:5000,responseType:"json",contentType:"",withCredentials:false,errStatus:{isOpenErr:false,errURL:"",},loadBalancing:{isOpen:false,cluster:[]},serviceSwitching:{isOpen:false,strategies:function(){},backupUrl:"",},pool:{isOpen:true,requestNumber:6,},transformRequest:function(i){return i},transformResponse:function(i){return i},successEvent:function(i){},errorEvent:function(i,k,j){},timeoutEvent:function(i,j){}};Array.prototype.indexOf=function(j){if(Array.indexOf){return Array.indexOf}else{if(JSON.stringify(j)==="{}"||j.length===0){return -1}else{for(var i in this[0]){if(this[0][i]===j){return i}else{return -1}}}}};var h={url:"String",type:"String",baseURL:"String",data:["Object","FormData"],async:"Boolean",requestHeader:"Object",publicData:"Object",timeout:"Number",responseType:"String",contentType:"String",withCredentials:"Boolean",errStatus:"Object",loadBalancing:"Object",serviceSwitching:"Object",pool:"Object",transformRequest:"function",transformResponse:"function",successEvent:"function",errorEvent:"function",timeoutEvent:"function"};var d={errAjax:{},isNeedSwitching:false,requestPool:[],queuePool:[],xhr:{}};var c={random:function(i,j){return Math.floor(Math.random()*(i-j+1)+j)},hasOwn:function(j,i){return Object.prototype.hasOwnProperty.call(j,i)},is:(function a(){var k={types:["Array","Boolean","Date","Number","Object","RegExp","String","Window","HTMLDocument","function","FormData"]};for(var j=0,l;l=k.types[j++];){k[l]=(function(i){return function(n){var m;if(i==="function"){m=typeof n==i}else{m=Object.prototype.toString.call(n)=="[object "+i+"]"}return m}})(l)}return k})(),keys:function(k){if(Object.keys){return Object.keys(k)}var j=[];for(var i in k){if(this.hasOwn(k,i)){j.push(i)}}return j},each:function(o,p){var n=this.keys(o);if(this.is.Array(o)&&[].forEach){o.forEach(p)}else{var l=0,j=n.length,k,m;while(l<j){k=n[l++];m=o[k];p.call(o,m,k)}}},isEmptyObject:function(j){var i;for(i in j){return !1}return !0},MergeObject:function(o,n){if(Object.assign){return Object.assign(o,n)}var m=this.keys(n),l=0;var j=m.length;while(l<j){var k=m[l++];o[k]=n[k]}return o},deepClone:function(n){var m=null,q=[n],l=[],j=[];c.is.Array(q[0])?m=[]:m={};var i=[m];while(q.length>0){var k=q.shift();var p=i.shift();l.push(k);j.push(p);for(var r in k){var s=k[r];if(typeof s!=="object"){p[r]=s}else{var o=l.indexOf(s);if(o>-1){p[r]=j[o]}else{q.push(s);c.is.Array(s)?p[r]=[]:p[r]={};i.push(p[r])}}}}return m},createXhrObject:function(){var j;try{XMLHttpRequest?(j=new XMLHttpRequest()):(j=new ActiveXObject("Microsoft.XMLHTTP"))}catch(i){throw new Error("ajax:Could not create an XHR object.")}return j},checkParam:function(j){var i=c.deepClone(g);c.MergeObject(i,j);return c.checkDataTypeBatch(i,h)?i:{}},checkRealUrl:function(i,j){if(/http:\/\/|https:\/\//.test(i)){if(g.errStatus.errURL!==i){if(g.loadBalancing.isOpen){i=i.replace(/^(http:\/\/|https:\/\/)/,"").replace(/^.*?\//,g.loadBalancing.cluster[c.random(g.loadBalancing.cluster.length-1,0)]+"/$`")}else{if(g.serviceSwitching.isOpen&&d.isNeedSwitching){i=i.replace(/^(http:\/\/|https:\/\/)/,"").replace(/^.*?\//,g.serviceSwitching.backupUrl+"/$`")}}}}else{i=g.baseURL+i;if(g.errStatus.errURL!==i){if(g.loadBalancing.isOpen){i=g.loadBalancing.cluster[c.random(g.loadBalancing.cluster.length-1,0)]+g.baseURL+i}else{if(g.serviceSwitching.isOpen&&d.isNeedSwitching){i=g.serviceSwitching.backupUrl+g.baseURL+i}}}}j.currentUrl=i;return i},checkDataTypeBatch:function(j,k){var i=true;c.each(j,function(o,m){if(k[m]===undefined){return}var l=k[m],n;if(c.is.Array(l)){c.each(l,function(p){n=n||c.is[p](o)})}else{n=c.is[l](o)}if(!n){j[m]=g[m]}});return i},getIEVersion:function(){return function(){if(f.VBArray){var i=document.documentMode;return i?i:f.XMLHttpRequest?7:6}else{return NaN}}()},cutFile:function(l,k){var m=l.size/k|0,n=[];for(var j=0;j<m;j++){n.push({name:l.name+".part"+(j+1),file:l.slice(k*j,k*(j+1))})}n.push({name:l.name+".part"+(m+1),file:l.slice(k*m,l.size)});return n},createPromise:function(){var i=function(n){var q=this;var j={PENDING:0,FULFILLED:1,REJECTED:2};q._fullCalll=[],q._rejCall=[];q._name="promise";var l=j.PENDING;var k=undefined;function p(s,r){var t=this;l=s;k=r;o.call(t)}function o(){var r=this,s;if(l===j.FULFILLED&&typeof r._fullCalll[0]==="function"){s=r._fullCalll[0](k)}if(l===j.REJECTED&&typeof r._rejCall[0]==="function"){s=r._rejCall[0](k)}if(s===undefined||!(typeof s==="object"&&s._name==="promise")){return}r._fullCalll.shift();r._rejCall.shift();s._fullCalll=r._fullCalll;s._rejCall=r._rejCall}function m(r){var s=this;r(function(t){p.call(s,j.FULFILLED,t)},function(t){p.call(s,j.REJECTED,t)})}this.then=function(s,r){this._fullCalll.push(s);this._rejCall.push(r);return this};m.call(q,n)};f.Promise=i},setOnerror:function(){f.onerror=function(j,i,k){b.post(g.errStatus.errURL,{type:"browser",errInfo:j,errUrl:i,errLine:k,Browser:navigator.userAgent})}},uploadAjaxError:function(i){if(g.errStatus.isOpenErr){if(i.errUrl!==g.errStatus.errURL){b.post(g.errStatus.errURL,i)
  }}if(d.errAjax[i.errUrl]===undefined){d.errAjax[i.errUrl]=1}else{d.errAjax[i.errUrl]+=1}if(g.serviceSwitching.isOpen){d.isNeedSwitching=g.serviceSwitching.strategies(d.errAjax)}},deepCloneXhr:function(o,n){var k={currentUrl:true,onerror:true,onload:true,onreadystatechange:true,ontimeout:true,timeout:true,withCredentials:true,xhr_ie8:true};var j={};for(var m in o){if(k[m]){if(isNaN(c.getIEVersion())&&m!=="timeout"){j[m]=o[m]}else{var p="_"+m;j[p]=o[m]}}}for(var l=0;l<n;l++){var q=c.createXhrObject();c.MergeObject(q,j);d.requestPool.push(q)}},createPool:function(){b.common({url:"/"},true);c.deepCloneXhr(d.xhr,g.pool.requestNumber)},useRequestPool:function(l){if(d.requestPool.length!==0){var k=d.requestPool.shift(),i="",j={};k.callback_success=l.successEvent;k.callback_error=l.errorEvent;k.callback_timeout=l.timeoutEvent;k.data=l.data;switch(l.contentType){case"":c.each(c.MergeObject(l.data,g.publicData),function(n,m){i+=(m+"="+n+"&")});i=i.slice(0,-1);break;case"json":i=JSON.stringify(c.MergeObject(l.data,g.publicData));break;case"form":if(!c.isEmptyObject(g.publicData)){c.each(g.publicData,function(n,m){l.data.append(m,n)})}i=l.data;break}if(l.type==="get"){k.open(l.type,c.checkRealUrl(l.url,k)+(i===""?"":("?"+i)))}else{k.open(l.type,c.checkRealUrl(l.url,k))}l.responseType?(k.responseType=l.responseType):null;if(!isNaN(c.getIEVersion())){k.timeout=k._timeout}switch(l.contentType){case"":j["Content-Type"]="application/x-www-form-urlencoded";break;case"json":j["Content-Type"]="application/json";break}c.each(c.MergeObject(j,g.requestHeader),function(n,m){k.setRequestHeader(m,n)});k.send(l.type==="get"?"":i)}else{d.queuePool.push(l)}},responseOver:function(j){d.requestPool.push(j);if(d.queuePool.length>0){var i=d.queuePool.shift();c.useRequestPool(i)}}};var b={common:function(j,l){var k=c.checkParam(j),i="";var m=c.createXhrObject();m.overrideMimeType?(m.overrideMimeType("text/javascript")):(null);m.onload===undefined?(m.xhr_ie8=true):(m.xhr_ie8=false);if(k.data){switch(k.contentType){case"":c.each(c.MergeObject(k.data,k.publicData),function(o,n){i+=(n+"="+o+"&")});i=i.slice(0,-1);k.requestHeader["Content-Type"]="application/x-www-form-urlencoded";break;case"json":i=JSON.stringify(c.MergeObject(k.data,k.publicData));k.requestHeader["Content-Type"]="application/json";break;case"form":if(!c.isEmptyObject(k.publicData)){c.each(k.publicData,function(o,n){k.data.append(n,o)})}i=k.data;break}i=k.transformRequest(i);if(k.type==="get"){m.open(k.type,c.checkRealUrl(k.url,m)+"?"+i,k.async)}else{m.open(k.type,c.checkRealUrl(k.url,m),k.async)}}else{m.open(k.type,k.baseURL+k.url,k.async)}if(k.async){m.timeout=k.timeout;m.responseType=k.responseType;m.withCredentials=k.withCredentials}else{m.withCredentials=false}c.each(k.requestHeader,function(o,n){m.setRequestHeader(n,o)});m.onload=function(n){if(this.readyState===4&&(this.status==200||this.status==304)){if(!isNaN(c.getIEVersion())){if(this.responseType==="json"){this.callback_success?this.callback_success(k.transformResponse(JSON.parse(this.responseText))):k.successEvent(k.transformResponse(JSON.parse(this.responseText)))}else{this.callback_success?this.callback_success(k.transformResponse(this.responseText)):k.successEvent(k.transformResponse(this.responseText))}}else{this.callback_success?this.callback_success(k.transformResponse(this.response)):k.successEvent(k.transformResponse(this.response))}}else{this.callback_error?this.callback_error(n.currentTarget.status,n.currentTarget.statusText):k.errorEvent(n.currentTarget.status,n.currentTarget.statusText);c.uploadAjaxError({type:"request",errInfo:JSON.stringify(this.data?this.data:k.data),errUrl:this.currentUrl,errLine:this.status,Browser:navigator.userAgent})}if(k.pool.isOpen){c.responseOver(this)}};m.onreadystatechange=function(){switch(this.readyState){case 1:break;case 2:break;case 3:break;case 4:if(this.xhr_ie8){if(this.status===200||this.status===304){if(this.responseType=="json"){this.callback_success?this.callback_success(k.transformResponse(JSON.parse(this.responseText))):k.successEvent(k.transformResponse(JSON.parse(this.responseText)))}else{this.callback_success?this.callback_success(k.transformResponse(this.responseText)):k.successEvent(k.transformResponse(this.responseText))}}else{c.uploadAjaxError({type:"request",errInfo:JSON.stringify(this.data?this.data:k.data),errUrl:this.currentUrl,errLine:this.status,Browser:navigator.userAgent})}if(k.pool.isOpen){c.responseOver(this)}}else{if(this.status===0){if(k.pool.isOpen){c.responseOver(this)}}}break}};m.ontimeout=function(n){this.callback_timeout?this.callback_timeout("000000",n?(n.type):("timeoutEvent")):k.timeoutEvent("000000",n?(n.type):("timeoutEvent"));this.abort();c.uploadAjaxError({type:"request",errInfo:JSON.stringify(this.data?this.data:k.data),errUrl:this.currentUrl,errLine:"timeout",Browser:navigator.userAgent})};m.onerror=function(q,n,r,o,p){this.callback_error?this.callback_error(q):k.errorEvent(q);c.uploadAjaxError({type:"request",errInfo:JSON.stringify(this.data?this.data:k.data),errUrl:this.currentUrl,errLine:"RequestErr",Browser:navigator.userAgent})
  };if(!l){m.send(k.type==="get"?"":i)}else{d.xhr=m}},config:function(j){var i=c.checkParam(j);c.MergeObject(g,i);if(g.errStatus.isOpenErr){c.setOnerror()}if(g.pool.isOpen){d.requestPool=[];d.queuePool=[];c.createPool()}},get:function(k,m,l,n,j){var i={type:"get",url:k,data:m,contentType:"",successEvent:l,errorEvent:n,timeoutEvent:j};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},post:function(k,m,l,n,j){var i={type:"post",url:k,data:m,contentType:"",successEvent:l,errorEvent:n,timeoutEvent:j};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},postJSON:function(k,m,l,n,j){var i={type:"post",url:k,data:m,contentType:"json",successEvent:l,errorEvent:n,timeoutEvent:j};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},postFormData:function(k,m,l,n,j){var i={type:"post",url:k,data:m,contentType:"form",successEvent:l,errorEvent:n,timeoutEvent:j};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},obtainBlob:function(l,k,n,m,o,j){var i={type:l,url:k,data:n,responseType:"blob",successEvent:m,errorEvent:o,timeoutEvent:j};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},promiseAjax:function(i,k,j){if(!f.Promise){c.createPromise()}return new Promise(function(m,l){if(j===undefined){b.post(i,k,m,l)}else{b.get(i,k,m,l)}})},longPolling:function(m,k,o,n,l,p,j){var i={type:m,url:k,data:o,contentType:"json",successEvent:function(q){n(q,this);if(!this.stop){setTimeout(function(){b.longPolling(m,k,o,n,l,p,j)},l)}},errorEvent:p,timeoutEvent:function(){j();setTimeout(function(){b.longPolling(m,k,o,n,l,p,j)},l)}};if(g.pool.isOpen){c.useRequestPool(i)}else{b.common(i)}},upload:function(j,l,r,s,i,m,o){var p=new FormData(),k=l.length,n={},q={};if(k>0){c.each(Array.prototype.slice.call(l),function(t){if(t.size>r){q["status"]=1;q["errMsg"]="超出文件限制大小"}else{if(s!="*"){if(s.indexOf(t.type)===-1){q["status"]=2;q["errMsg"]="非允许文件格式"}else{p.append(t.name,t)}}else{p.append(t.name,t)}}})}else{q["status"]=0;q["errMsg"]="请选择文件"}if(q.status!==undefined){return q}b.postFormData(j,p,i,m,o)},upload_big:function(j,k,r,t,i,o,m,p){var s={};if(k.length===1){if(t!="*"){if(t.indexOf(k.type)===-1){s["status"]=1;s["errMsg"]="非允许文件格式"}}}else{s["status"]=0;s["errMsg"]="请选择文件/只能上传一个文件"}if(s.status!==undefined){return s}if(k[0].size>r){var l=c.cutFile(k[0],r);q(l)}else{var n=new FormData();n.append("name",k[0].name);n.append("file".name,k[0]);n.append("count",1);n.append("cutSize",r);b.postFormData(j,n,function(u){i(u);o(1,1)},m,p)}function q(w,u){var v=new FormData();if(u==undefined){u=0;v.append("name",w[0].name);v.append("file".name,w[0].file)}else{if(u===w.length-1){v.append("isLast","true")}v.append("name",w[u].name);v.append("file".name,w[u].file)}v.append("count",u);v.append("cutSize",r);b.postFormData(j,v,function(y){o(u+1,w.length);var x=Number(y);if(x){if(x!=w.length){q(w,x)}}i(y)},m,p)}}};var e=function(){if(c.getIEVersion()<7){throw new Error("Sorry,please update your browser.(IE8+)")}if(g.pool.isOpen){c.createPool()}return b};f.ajax=new e()})(this);
